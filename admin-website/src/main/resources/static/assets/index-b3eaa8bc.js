import{d as C,r as I,a8 as V,c as N,u,y as D,H as r,W as t,l as e,w as o,E as _,v as f,M,N as q,J as T,Z as F,_ as G,k as U}from"./vue-fdfdc7c1.js";import{q as g,t as b,_ as L,I as P,B as O}from"./index-387d5142.js";import{a as d,G as R,R as Y,C as E}from"./index-c544811c.js";import{D as H}from"./index-ebd49e8e.js";import{F as S,a as j}from"./index-71dedec5.js";import{t as k}from"./time-ae4bc627.js";import"./index-cd31dfea.js";import{G as A}from"./index-3d632649.js";import"./chevron-up-775d40e5.js";import"./index-9e0a2cd3.js";import"./index-10398010.js";import"./index-51ecf215.js";import"./warning-triangle-0392a7a8.js";function z(a){return g({url:"/api/admin/v1/scb/admin/observability/searchTrace",params:{timestamp:a.timestamp,traceId:a.traceId}})}function J(a){return g({url:"/api/admin/v1/scb/admin/observability/searchLog",params:{timestamp:a.timestamp,traceId:a.traceId}})}function W(a){return g({url:"/api/admin/v1/scb/observability/downloadLog",params:a})}function Z(a){return g.get("/api/admin/v1/scb/admin/observability/downloadMetrics",{params:a})}const K={key:1},Q=["onClick"],X=["onClick"],tt=C({__name:"call-chain-list",props:{traceData:{type:Array,default(){return[]}},listTypes:{type:String,default(){return b.TYPE_LIST}},timestamp:{type:String,default(){return""}}},setup(a,{expose:v}){const m=a,p=I(),h=V({traceData:N(()=>m.traceData)}),s=()=>{p.value.clearRowExpand()},y=(l,n)=>{const c=window.URL.createObjectURL(new Blob([l],{type:"text/plain"})),i=document.createElement("a");i.href=c,i.setAttribute("download",n),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(c)},x=(l,n)=>{const c={serviceName:l,timestamp:m.timestamp,instanceId:n};W(c).then(i=>{y(i,"Log.txt")})},w=(l,n)=>{const c={serviceName:l,timestamp:m.timestamp,instanceId:n};Z(c).then(i=>{y(i,"Metrics.txt")})};return v({clearExpand:s}),(l,n)=>(u(),D(t(R),{ref_key:"listRef",ref:p,resizable:"","seq-serial":"",data:h.traceData},{toolbar:r(()=>[e(t(A),null,{default:r(()=>[o("span",null,_(a.listTypes===t(b).TYPE_LOGS?"日志":"调用链")+"列表",1)]),_:1})]),default:r(()=>[e(t(d),{type:"index",width:"60"}),e(t(d),{width:"60"}),e(t(d),{type:"expand",title:"data",width:"60"},{default:r(c=>[a.listTypes===t(b).TYPE_LIST?(u(),D(t(R),{key:0,data:c.row.data},{default:r(()=>[e(t(d),{field:"name",title:"name","show-overflow":""}),e(t(d),{field:"duration",title:"duration"}),e(t(d),{field:"traceId",title:"http.status_code"},{default:r(i=>[o("div",null,_(i.row.tags["http.status_code"]),1)]),_:2},1024),e(t(d),{field:"timestamp",title:"timestamp"},{default:r(i=>[o("div",null,_(t(k)(i.row.timestamp/1e3,!1)),1)]),_:2},1024),e(t(d),{field:"http.route",title:"http.route"},{default:r(i=>[o("div",null,_(i.row.tags["http.route"]),1)]),_:2},1024)]),_:2},1032,["data"])):(u(),f("div",K,[(u(!0),f(M,null,q(c.row.data,(i,$)=>(u(),f("div",{key:$,class:"logs-list"},_(i),1))),128))]))]),_:1}),e(t(d),{field:"application",title:"application"}),e(t(d),{field:"instanceId",title:"instanceId"}),e(t(d),{field:"localhost",title:"localhost"}),e(t(d),{field:"serviceName",title:"serviceName"}),e(t(d),{title:"操作",width:"150"},{default:r(c=>[o("div",null,[o("span",{class:"list-operation",onClick:i=>x(c.row.serviceName,c.row.instanceId)},"查看日志",8,Q),T(" |  "),o("span",{class:"list-operation",onClick:i=>w(c.row.serviceName,c.row.instanceId)},"查看Metrics",8,X)])]),_:1})]),_:1},8,["data"]))}});const B=L(tt,[["__scopeId","data-v-7c5944f6"]]),et=a=>(F("data-v-69e5064f"),a=a(),G(),a),at={class:"main"},st=et(()=>o("div",{class:"main-title"},[o("span"),o("p",null,"调用链搜索")],-1)),it={class:"main-content"},rt={class:"main-content-form"},ot={class:"main-content-search"},lt={class:"clear-expand"},nt={class:"main-list"},ct=C({__name:"main",setup(a){const v={traceId:[{required:!0,message:"必填",trigger:"blur"}],startTime:[{required:!0,message:"请选择时间"}]},m=I(),p=I(),h=I(),s=V({filterOptions:{startTime:"",traceId:""},timestamp:"",traceData:[],listData:[],validType:"text",rules:{traceId:[{required:!0,message:"必填",trigger:"blur"}],startTime:[{required:!0,message:"请选择时间"}]}}),y=()=>{m.value.validate(w=>{if(w){const l=new Date(s.filterOptions.startTime);s.timestamp=k(l,!0),z({timestamp:s.timestamp,traceId:s.filterOptions.traceId}).then(n=>{s.traceData=n}),J({timestamp:k(l,!0),traceId:s.filterOptions.traceId}).then(n=>{s.listData=n})}})},x=()=>{p.value.clearExpand(),h.value.clearExpand()};return(w,l)=>(u(),f("div",at,[st,o("div",it,[o("div",rt,[e(t(j),{ref_key:"searchForm",ref:m,model:s.filterOptions,"validate-type":s.validType,rules:v,"label-width":"100px",class:"demo-form"},{default:r(()=>[e(t(Y),null,{default:r(()=>[e(t(E),{span:6},{default:r(()=>[e(t(S),{label:"Trace-Id:",prop:"traceId"},{default:r(()=>[e(t(P),{modelValue:s.filterOptions.traceId,"onUpdate:modelValue":l[0]||(l[0]=n=>s.filterOptions.traceId=n),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(t(E),{span:6},{default:r(()=>[e(t(S),{label:"大概时间:",prop:"startTime"},{default:r(()=>[e(t(H),{modelValue:s.filterOptions.startTime,"onUpdate:modelValue":l[1]||(l[1]=n=>s.filterOptions.startTime=n),type:"datetime"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","validate-type"])]),o("div",ot,[e(t(O),{type:"primary",onClick:y},{default:r(()=>[T("搜索")]),_:1})])]),o("div",lt,[e(t(O),{onClick:x},{default:r(()=>[T("手动清空展开行状态")]),_:1})]),o("div",nt,[e(B,{ref_key:"chainRef",ref:p,timestamp:s.timestamp,"trace-data":s.traceData},null,8,["timestamp","trace-data"]),e(B,{ref_key:"logsRef",ref:h,timestamp:s.timestamp,"trace-data":s.listData,"list-types":t(b).TYPE_LOGS},null,8,["timestamp","trace-data","list-types"])])]))}});const dt=L(ct,[["__scopeId","data-v-69e5064f"]]),mt={class:"container"},pt={class:"contain"},ut=C({__name:"index",setup(a){return(v,m)=>{const p=U("Breadcrumb");return u(),f("div",mt,[o("div",pt,[e(p,{items:["menu.cloud","menu.cloud.locate.problems"]}),e(dt)])])}}});const Lt=L(ut,[["__scopeId","data-v-e19f70fa"]]);export{Lt as default};
